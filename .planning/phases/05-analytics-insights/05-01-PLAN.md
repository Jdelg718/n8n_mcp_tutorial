---
phase: 05-analytics-insights
plan: 01
type: execute
---

<objective>
Build analytics page foundation with time range filtering and summary statistics.

Purpose: Enable users to analyze nutrition patterns over different time periods with clear statistical summaries.
Output: Analytics page with time range selector, summary stats cards, and data fetching infrastructure using Recharts library.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work
@.planning/phases/04-dashboard-meals/04-01-SUMMARY.md
@.planning/phases/04-dashboard-meals/04-02-SUMMARY.md

# Existing patterns
@app/dashboard/actions.ts
@app/dashboard/meals/actions.ts
@components/dashboard/TodayTotals.tsx

**Tech stack available:**
- Next.js 14 Server Components for data fetching
- Supabase client with RLS policies
- TypeScript with strict mode
- Tailwind CSS for styling
- date-fns for date manipulation (already installed)

**Established patterns:**
- Server Actions in actions.ts files for data fetching
- Server Components for pages with direct data access
- URL search params for filter state management
- Responsive layout with grid and flex patterns
- Empty states with call-to-action

**Constraining decisions:**
- Hardcoded nutrition goals (2000 kcal, 150g protein, 250g carbs, 67g fat) from Phase 04
- RLS policies automatically filter by user_id
- Always use auth.getUser() (never getSession())

**New library:**
Recharts is being added for data visualization. Context7 verification confirms:
- Works with React 19 and Next.js 14
- Supports SSR for Server Components
- ResponsiveContainer handles responsive charts
- Install: `npm install recharts`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create analytics data Server Actions</name>
  <files>package.json, app/dashboard/analytics/actions.ts</files>
  <action>
  1. Install Recharts: `npm install recharts`
  2. Create app/dashboard/analytics/actions.ts with Server Actions:
     - `getAnalyticsSummary(startDate: string, endDate: string)` - Returns: { totalMeals: number, avgCalories: number, avgProtein: number, avgCarbs: number, avgFat: number, dateRange: string }
     - `getDailyNutrition(startDate: string, endDate: string)` - Returns array: { date: string, calories: number, protein: number, carbs: number, fat: number }[]
     - `getMacroDistribution(startDate: string, endDate: string)` - Returns: { protein: number, carbs: number, fat: number } (totals for pie chart)
  3. Follow Phase 04 patterns: auth.getUser() check, RLS automatic filtering, handle null nutrition values with || 0
  4. Use date-fns for date range calculations and formatting
  5. Round numeric values appropriately (calories to integer, macros to 1 decimal)
  </action>
  <verify>npm list recharts shows installed version, TypeScript compiles without errors, Server Actions export proper types</verify>
  <done>Recharts installed, analytics/actions.ts created with 3 Server Actions, all properly typed with auth checks and RLS</done>
</task>

<task type="auto">
  <name>Task 2: Create analytics page with time range selector</name>
  <files>app/dashboard/analytics/page.tsx, components/analytics/TimeRangeSelector.tsx</files>
  <action>
  1. Create app/dashboard/analytics/page.tsx as Server Component:
     - Read time range from URL search params (default: '7d')
     - Calculate startDate and endDate based on range using date-fns
     - Fetch analytics summary with getAnalyticsSummary(startDate, endDate)
     - Layout: heading, TimeRangeSelector, summary stats, placeholder for charts
  2. Create components/analytics/TimeRangeSelector.tsx as Client Component:
     - Time range buttons: Today, 7 Days, 30 Days, 90 Days, All Time
     - Use useRouter and useSearchParams to update URL (like Phase 04 filters)
     - Active state styling for selected range
     - Responsive: horizontal scrollable buttons on mobile, flex row on desktop
  3. Follow Phase 04 URL state pattern: Client component updates URL, Server component reads params
  4. Add navigation link to analytics page in dashboard layout sidebar/nav
  </action>
  <verify>Visit /dashboard/analytics, time range buttons update URL and trigger page re-render, no TypeScript errors</verify>
  <done>Analytics page created, time range selector updates URL search params, page fetches data for selected range</done>
</task>

<task type="auto">
  <name>Task 3: Build summary stats cards component</name>
  <files>components/analytics/SummaryStats.tsx, app/dashboard/analytics/page.tsx</files>
  <action>
  1. Create components/analytics/SummaryStats.tsx displaying summary data:
     - 4 stat cards in responsive grid: Total Meals, Avg Calories/day, Avg Protein/day, Avg Carbs/day
     - Each card: large number value, label, optional subtitle (e.g., "over last 7 days")
     - Use Tailwind for card styling: border, rounded, padding, shadow
     - Responsive: 2x2 grid on desktop, 1 column on mobile
  2. Display date range context: "January 5 - January 12, 2026" using date-fns format
  3. Handle empty state: "No meals logged in this period. Try a different time range."
  4. Integrate SummaryStats into analytics page.tsx
  5. Follow Phase 04 component patterns for layout and styling
  </action>
  <verify>Analytics page displays summary stats cards with correct calculations, empty state shows when no data, responsive layout works on mobile</verify>
  <done>Summary stats cards display total meals and averages, date range context shown, empty state handles no data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Analytics page accessible at /dashboard/analytics
- [ ] Time range selector updates URL and refetches data
- [ ] Summary stats display correct calculations for selected range
- [ ] Empty state appears when no meals in range
- [ ] Responsive layout works on mobile and desktop
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Analytics infrastructure ready for charts in next plan
- Summary stats provide meaningful insights for different time ranges
</success_criteria>

<output>
After completion, create `.planning/phases/05-analytics-insights/05-01-SUMMARY.md`:

# Phase 5 Plan 1: Analytics Infrastructure & Time Range Selector Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 05-02-PLAN.md (Nutrition Trends Charts with Recharts line and pie charts)
</output>
