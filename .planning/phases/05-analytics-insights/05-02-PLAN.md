---
phase: 05-analytics-insights
plan: 02
type: execute
---

<objective>
Create interactive nutrition trend visualizations with Recharts line and pie charts.

Purpose: Enable users to visualize daily calorie trends and macro distribution patterns over time.
Output: Calorie trends line chart showing daily nutrition over selected period and macro distribution pie chart with interactive tooltips.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work - this phase
@.planning/phases/05-analytics-insights/05-01-SUMMARY.md

# Recharts setup from Plan 1
@app/dashboard/analytics/actions.ts

**Tech stack available:**
- Recharts library installed and verified
- getDailyNutrition() Server Action returns daily data points
- getMacroDistribution() Server Action returns macro totals
- date-fns for date formatting in charts

**Recharts patterns from Context7:**
- Use ResponsiveContainer for responsive charts (width="100%" height={300-400})
- LineChart with CartesianGrid, XAxis, YAxis, Tooltip, Legend, Line components
- PieChart with Pie, Cell, Tooltip, Legend components
- Custom label functions for pie chart percentages
- Color arrays for consistent styling

**Established patterns:**
- Charts will be Client Components ("use client") due to interactivity
- Server Components (page.tsx) pass data as props to chart components
- Responsive layout with grid for multiple charts
- Tailwind styling for chart containers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create calorie trends line chart component</name>
  <files>components/analytics/CalorieTrendsChart.tsx, app/dashboard/analytics/page.tsx</files>
  <action>
  1. Create components/analytics/CalorieTrendsChart.tsx as Client Component ("use client"):
     - Props: data from getDailyNutrition() - { date: string, calories: number, protein: number, carbs: number, fat: number }[]
     - Use Recharts ResponsiveContainer with width="100%" height={350}
     - LineChart with CartesianGrid (strokeDasharray="3 3" for dashed grid)
     - XAxis dataKey="date" - format dates with date-fns to "MMM d" (e.g., "Jan 5")
     - YAxis for calorie values with label "Calories"
     - Tooltip showing date and calorie value
     - Line for calories (stroke="#3b82f6" blue, strokeWidth={2}, type="monotone" for smooth curves)
     - Optional: Add lines for protein/carbs/fat with different colors if space allows
  2. Wrap in card container with title "Daily Calorie Trends" and subtitle showing date range
  3. Handle empty state: "No data available for this period"
  4. Integrate into analytics page.tsx below summary stats
  5. Follow Context7 ResponsiveContainer pattern exactly to avoid client-side rendering issues
  </action>
  <verify>Chart renders with daily data points, x-axis shows formatted dates, y-axis shows calorie scale, tooltip works on hover, chart is responsive</verify>
  <done>Line chart displays daily calorie trends over selected time range with interactive tooltips and responsive design</done>
</task>

<task type="auto">
  <name>Task 2: Build macro distribution pie chart component</name>
  <files>components/analytics/MacroDistributionChart.tsx, app/dashboard/analytics/page.tsx</files>
  <action>
  1. Create components/analytics/MacroDistributionChart.tsx as Client Component ("use client"):
     - Props: data from getMacroDistribution() - { protein: number, carbs: number, fat: number }
     - Transform to Recharts format: [{ name: 'Protein', value: protein, color: '#ef4444' }, { name: 'Carbs', value: carbs, color: '#3b82f6' }, { name: 'Fat', value: fat, color: '#f59e0b' }]
     - Use ResponsiveContainer width="100%" height={350}
     - PieChart with Pie component:
       - cx="50%" cy="50%" (center pie)
       - outerRadius={120} for visible size
       - labelLine={false}
       - Custom label showing percentage: `${(percent * 100).toFixed(0)}%`
       - dataKey="value"
     - Use Cell components inside Pie to apply colors from data array
     - Tooltip showing macro name and gram value
     - Legend below pie showing color-coded macro names
  2. Wrap in card container with title "Macro Distribution" and subtitle "Protein, Carbs, Fat"
  3. Handle empty state: "No nutrition data available"
  4. Follow Context7 PieChart pattern with custom labels
  5. Integrate into analytics page.tsx in 2-column grid with line chart (desktop) or stacked (mobile)
  </action>
  <verify>Pie chart displays macro distribution with percentage labels, legend shows color-coded macros, tooltip works, chart is responsive</verify>
  <done>Pie chart visualizes protein/carbs/fat distribution with interactive tooltips, percentages, and legend</done>
</task>

<task type="auto">
  <name>Task 3: Enhance charts with tooltips and responsive layout</name>
  <files>app/dashboard/analytics/page.tsx, components/analytics/CalorieTrendsChart.tsx, components/analytics/MacroDistributionChart.tsx</files>
  <action>
  1. Update CalorieTrendsChart tooltip to show:
     - Date (formatted: "January 5, 2026")
     - Calories: {value} kcal
     - Optional: Protein/carbs/fat if shown as additional lines
  2. Update MacroDistributionChart tooltip to show:
     - Macro name
     - Grams: {value}g
     - Percentage: {percent}%
  3. Create responsive 2-column grid layout in analytics page:
     - Desktop: Line chart (left), Pie chart (right) in grid-cols-2
     - Mobile: Stack vertically in grid-cols-1
     - Both charts in card containers with border, shadow, padding
  4. Add subtle hover states to charts (Recharts handles this by default)
  5. Ensure charts update when time range selector changes (data fetched from Server Action based on URL params)
  6. Add loading skeleton or placeholder while data fetches (optional - SSR means instant render)
  </action>
  <verify>Charts display in responsive grid layout, tooltips show detailed information, charts update when time range changes, no layout shift on render</verify>
  <done>Analytics page has responsive chart layout with enhanced tooltips and smooth interactions across time ranges</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Calorie trends line chart displays daily data with formatted dates
- [ ] Macro distribution pie chart shows percentages and legend
- [ ] Both charts are responsive and work on mobile/desktop
- [ ] Tooltips provide detailed information on hover
- [ ] Charts update correctly when time range selector changes
- [ ] Empty states handle periods with no data
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Charts provide meaningful visual insights
- Interactive tooltips enhance data exploration
- Responsive layout works across devices
</success_criteria>

<output>
After completion, create `.planning/phases/05-analytics-insights/05-02-SUMMARY.md`:

# Phase 5 Plan 2: Nutrition Trends Charts Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 05-03-PLAN.md (AI-generated nutrition insights with pattern analysis)
</output>
